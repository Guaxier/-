import{U as O,a7 as Z,E as D,d as E,r as h,K as ee,g as d,c as p,b as o,w as a,a as e,F as V,v as P,n as J,t as f,L as B,h as S,i as F,V as j,f as _,p as K,j as H,_ as M,I as Q,x as U,a8 as te,a6 as se,a9 as oe,G as W,C as le,o as X,$ as ne}from"./index.aa0178c7.js";import{b as ue,c as ae,d as re}from"./order.a9b7f7f3.js";import{s as G}from"./common.dc574b31.js";const Y="/cms/assets/erweima.b4ceebf5.svg",de=()=>O({url:"desk_all"}),ce=t=>O({url:"desk_add",method:"POST",data:t}),ie=t=>O({url:`desk_del?id=${t}`,method:"DELETE"}),_e=t=>O({url:`desk_end?id=${t}`,method:"PUT"}),g=Z({id:"tableStore",state:()=>({proArr:[],desk:{id:0,name:"",order_id:0,order_num:""},old_order:[],user:{},coupon:0,category_id:0}),getters:{},actions:{setTotal(){let t=0;for(const l of this.proArr)t+=l.num*l.price;return t},addProArr(t){for(const l of this.proArr)if(l.sku_name){if(l.goods_name==t.goods_name&&l.sku_name==t.sku_name){D.info("\u6B64\u5546\u54C1\u5DF2\u5B58\u5728\uFF01");return}}else if(l.goods_name==t.goods_name){D.info("\u6B64\u5546\u54C1\u5DF2\u5B58\u5728");return}this.proArr.push(t)},clearProArr(){this.proArr=[]},deskEnd(){_e(this.desk.id).then(()=>{D.success("\u7ED3\u7B97\u6210\u529F"),this.clearProArr()})},createOrder(){const t={desk_id:this.desk.id,money:this.setTotal(),total_money:this.setTotal(),json:this.proArr};ue(t).then(()=>{D.success("\u8BA2\u5355\u521B\u5EFA\u6210\u529F"),this.clearProArr()})},upOrder(){const t={order_id:this.desk.order_id,desk_id:this.desk.id,money:this.setTotal(),total_money:this.setTotal(),json:this.proArr};ae(t).then(()=>{D.success("\u8BA2\u5355\u4FEE\u6539\u6210\u529F"),this.clearProArr()})},setDesk(t,l,n){if(this.desk.id=t,this.desk.name=l,this.desk.order_id=n,this.desk.order_num="",n==0){this.clearProArr();return}re(n).then(u=>{this.desk.order_num=u.order_num,this.old_order=JSON.parse(JSON.stringify(u.pro_arr)),this.proArr=u.pro_arr})}}}),L=t=>(K("data-v-0e7879b5"),t=t(),H(),t),me={class:"drawer-left"},pe={class:"p-4"},ve={class:"px-2 py-3 bor"},he={class:"flex justify-between"},fe=["onClick"],ye={class:"flex justify-between"},xe={class:"w-3/4 text-sm"},ge={key:0},ke=L(()=>e("div",{class:"w-1/4 text-right"},null,-1)),Fe={class:"flex justify-between text-sm mt-3"},we={class:"w-3/4"},Ae={class:"w-1/4 text-right"},be={class:"absolute bottom-4 p-4 w-full text-gray-500 text-sm"},$e={class:"py-2"},De={class:"borde py-3 px-1 flex"},Ee=L(()=>e("div",{class:"w-15 mt-1"},"\u5907\u6CE8\uFF1A",-1)),Ce={class:"borde py-3 px-1"},Be=L(()=>e("div",{class:"borde py-3 px-1"},[e("span",null,"\u4F18\u60E0\uFF1A0.00")],-1)),Ve={class:"py-3 px-1 text-red-600"},Te={key:0,class:"text-center flex justify-evenly"},Se=F("\u6E05\u7A7A"),je=F("\u63D0\u4EA4\u8BA2\u5355"),Pe={key:1,class:"text-center flex justify-evenly"},Ue=F("\u66F4\u65B0\u8BA2\u5355"),Oe=F("\u7ED3\u7B97"),Ie=E({__name:"left",props:{closeFun:{type:Function,required:!0}},setup(t){const l=t,n=h([]),u=h(0),c=h(""),r=h(!1),s=h(),y=h(0);ee(()=>{if(n.value=g().proArr,s.value=g().old_order,r.value=!1,u.value==1)if(n.value.length!==s.value.length)r.value=!0;else{let $=0,b=0;for(const A of n.value)$+=A.num;for(const A of s.value)b+=A.num;$!==b&&(r.value=!0)}g().desk.order_id?u.value=1:u.value=0,y.value=g().setTotal()});const v=$=>{console.log("del"),n.value.splice($,1)},w=()=>{j.confirm("\u786E\u5B9A\u6E05\u7A7A?","",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}).then(()=>{g().clearProArr(),n.value=g().proArr})},C=()=>{j.confirm("\u786E\u5B9A\u63D0\u4EA4\u8BA2\u5355\uFF1F","\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}).then(()=>{g().createOrder(),setTimeout(()=>{l.closeFun()},500)})},x=()=>{j.confirm("\u786E\u5B9A\u66F4\u65B0\u8BA2\u5355\uFF1F","\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}).then(()=>{g().upOrder(),setTimeout(()=>{l.closeFun()},500)})},i=()=>{j.confirm("\u786E\u5B9A\u7ED3\u7B97\uFF1F","\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}).then(()=>{g().deskEnd(),setTimeout(()=>{l.closeFun()},500)})};return($,b)=>{const A=_("CircleClose"),I=_("el-icon"),N=_("el-input-number"),z=_("el-scrollbar"),q=_("el-input"),m=_("el-button");return d(),p("div",me,[o(z,{height:"500px",class:"shadow-sm"},{default:a(()=>[e("div",pe,[(d(!0),p(V,null,P(n.value,(k,T)=>(d(),p("div",ve,[e("div",he,[e("div",{class:J(["w-3/4 text-sm",T>=s.value.length&&r.value?"text-red-400":""])},f(k.goods_name),3),e("div",{class:"w-1/4 text-right mt-2",onClick:R=>v(T)},[o(I,null,{default:a(()=>[o(A)]),_:1})],8,fe)]),e("div",ye,[e("div",xe,[k.sku_name?(d(),p("span",ge,"[ "+f(k.sku_name)+" ]",1)):B("",!0)]),ke]),e("div",Fe,[e("div",we,"\xA5 "+f(k.price),1),e("div",Ae,[o(N,{size:"small",modelValue:k.num,"onUpdate:modelValue":R=>k.num=R,min:"1",max:"99"},null,8,["modelValue","onUpdate:modelValue"])])])]))),256))])]),_:1}),e("div",be,[e("div",$e,[e("div",De,[Ee,o(q,{modelValue:c.value,"onUpdate:modelValue":b[0]||(b[0]=k=>c.value=k),class:"w-50",placeholder:"\u53EF\u8F93\u5165\u5907\u6CE8\u4FE1\u606F"},null,8,["modelValue"])]),e("div",Ce,[e("span",null,"\u5408\u8BA1\uFF1A"+f(y.value),1)]),Be,e("div",Ve,[e("span",null,"\u5E94\u4ED8\uFF1A"+f(y.value),1)])]),u.value==0?(d(),p("div",Te,[n.value.length>0?(d(),S(m,{key:0,round:"",size:"large",onClick:w},{default:a(()=>[Se]),_:1})):B("",!0),u.value==0?(d(),S(m,{key:1,style:{height:"37px"},type:"danger",class:"w-full",round:"",onClick:C,disabled:n.value.length<1?"disabled":!1},{default:a(()=>[je]),_:1},8,["disabled"])):B("",!0)])):(d(),p("div",Pe,[n.value.length>0?(d(),S(m,{key:0,round:"",size:"large",disabled:!r.value,onClick:x},{default:a(()=>[Ue]),_:1},8,["disabled"])):B("",!0),o(m,{style:{height:"37px"},type:"warning",class:"w-full",round:"",onClick:i,disabled:r.value},{default:a(()=>[Oe]),_:1},8,["disabled"])]))])])}}});const Ne=M(Ie,[["__scopeId","data-v-0e7879b5"]]),ze=t=>(K("data-v-847432e1"),t=t(),H(),t),qe={class:"drawer-middle"},Me={class:"flex py-2 flex-wrap"},Le={key:0,class:"w text-sm my-5"},Re=["onClick","src"],Ge={class:"text-gray-700"},Je=ze(()=>e("div",{class:"text-gray-400 h-5"},null,-1)),Ke={class:"text-red-500"},He=["onClick","src"],Qe={class:"text-gray-700"},We={class:"text-gray-400 h-5"},Xe={class:"text-red-500"},Ye=E({__name:"middle",setup(t){const l=h();Q().getPros.then(c=>{l.value=c});const n=(c,r,s,y)=>{let v={goods_id:c,goods_name:r,price:s,sku_name:y,num:1};g().addProArr(v)},u=c=>{let r=c.s1_name;return c.s2_name&&(r+="_"+c.s2_name),c.s3_name&&(r+="_"+c.s3_name),r};return(c,r)=>(d(),p("div",qe,[e("div",Me,[(d(!0),p(V,null,P(l.value,(s,y)=>(d(),p(V,{key:s.id},[s.sku.length<1?(d(),p("div",Le,[e("img",{class:"w-25 h-25 rounded-md cursor-pointer",onClick:v=>n(s.id,s.title,s.price,""),src:U(G)(s.url),alt:"\u56FE\u7247"},null,8,Re),e("div",Ge,f(s.title),1),Je,e("div",Ke,"\uFFE5"+f(s.price),1)])):(d(!0),p(V,{key:1},P(s.sku,(v,w)=>(d(),p("div",{key:w,class:"w text-sm my-5"},[e("img",{class:"w-25 h-25 rounded-md cursor-pointer",onClick:C=>n(s.id,s.title,v.price,u(v)),src:U(G)(s.url),alt:"\u56FE\u7247"},null,8,He),e("div",Qe,f(s.title),1),e("div",We,"[ "+f(u(v))+" ]",1),e("div",Xe,"\uFFE5"+f(v.price),1)]))),128))],64))),128))])]))}});const Ze=M(Ye,[["__scopeId","data-v-847432e1"]]),et={class:"drawer bg-white"},tt={class:"w-1/2 flex text-md"},st={class:"px-2 text-gray-800"},ot={key:0,class:"pl-10 text-sm pt-5 text-gray-500"},lt={class:"pr-2 text-sm"},nt={class:"flex h-full pt-3 px-2 pb-3"},ut={class:"w-3/10 bg-white rounded-xl shadow-md text-gray-500 relative"},at={class:"bg-white w-7/10 ml-3 mr-3 rounded-xl shadow-md p-4 text-center"},rt=E({__name:"drawer",props:{modelValue:{type:Boolean,required:!0}},emits:["update:modelValue"],setup(t,{emit:l}){const n=h();n.value=g().desk;const u=()=>{l("update:modelValue",!1)};return(c,r)=>{const s=_("Right"),y=_("el-icon");return d(),p("div",et,[o(U(oe),{modelValue:t.modelValue,"onUpdate:modelValue":r[0]||(r[0]=v=>se(modelValue)?modelValue.value=v:null),"show-close":!1,onClose:u,size:"70%","custom-class":"drawer"},{header:a(({close:v})=>[e("div",tt,[e("div",st,"\u9910\u684C\u540D\u79F0\uFF1A"+f(n.value.name),1),n.value.order_id>0?(d(),p("div",ot," \u8BA2\u5355\u53F7\uFF1A"+f(n.value.order_num),1)):B("",!0)]),e("div",lt,[o(U(te),{type:"primary",onClick:v},{default:a(()=>[o(y,{size:24},{default:a(()=>[o(s)]),_:1})]),_:2},1032,["onClick"])])]),default:a(()=>[e("div",nt,[e("div",ut,[o(Ne,{closeFun:u})]),e("div",at,[o(Ze)])])]),_:1},8,["modelValue"])])}}}),dt=e("div",{class:"w-full text-center"},[e("img",{src:Y,alt:""})],-1),ct=E({__name:"erweimaDialog",props:{modelValue:{type:Boolean,required:!0},erweimaData:{type:Object,required:!0}},emits:["update:modelValue"],setup(t,{emit:l}){const n=t,u=h();W(()=>n.erweimaData,r=>{u.value=r.name});const c=()=>{l("update:modelValue",!1)};return(r,s)=>{const y=_("el-dialog");return d(),S(y,{"model-value":t.modelValue,title:`\u9910\u684C\u540D\u79F0\uFF1A${u.value}`,width:"25%",onClose:c,center:""},{default:a(()=>[dt]),_:1},8,["model-value","title"])}}}),it={class:"dialog-footer"},_t=F("\u7ACB\u5373\u521B\u5EFA"),mt=E({__name:"addDesk",props:{modelValue:{type:Boolean,required:!0}},emits:["update:modelValue","sub"],setup(t,{emit:l}){const n=()=>{l("update:modelValue",!1),u.name="",l("sub")},u=le({name:""}),c=()=>{u.name.trim()===""?D.info("\u8BF7\u586B\u5199\u540D\u79F0"):ce(u).then(r=>{n()})};return(r,s)=>{const y=_("el-input"),v=_("el-form-item"),w=_("el-form"),C=_("el-button"),x=_("el-dialog");return d(),S(x,{"model-value":t.modelValue,width:"40%",onClose:n,center:""},{footer:a(()=>[e("span",it,[o(C,{type:"primary",onClick:c},{default:a(()=>[_t]),_:1})])]),default:a(()=>[o(w,null,{default:a(()=>[o(v,{label:"\u540D\u79F0"},{default:a(()=>[o(y,{modelValue:u.name,"onUpdate:modelValue":s[0]||(s[0]=i=>u.name=i)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["model-value"])}}});const pt=M(mt,[["__scopeId","data-v-72bc617b"]]),vt={class:"flex"},ht=F(" \u5168\u90E8 "),ft=F(" \u5F85\u7ED3\u8D26 "),yt=F(" \u7A7A\u684C "),xt={class:"py-5 flex text-gray-500"},gt={class:"h-10 flex justify-between"},kt={class:"text-sm p-2"},Ft={class:"p-3"},wt=["onClick"],At={class:"pt-9 text-center text-3xl text-gray-800"},bt=e("span",{class:"text-xl"},"\xA5",-1),$t=["onClick"],Dt=e("img",{class:"w-5 h-5",src:Y,alt:""},null,-1),Et=[Dt],Ct=E({__name:"deskMain",setup(t){const l=h(!1),n=h(!1),u=h(!1),c=h(),r=h(),s=h(-1),y=x=>{r.value=x,n.value=!0},v=x=>{ie(x).then(i=>{D.success("\u5DF2\u5220\u9664"),w()})};X(()=>{w()});function w(){de().then(x=>{c.value=x})}const C=x=>{const i=c.value[x];g().setDesk(i.id,i.name,i.order_id),l.value=!0};return W(l,()=>{l.value||w()}),(x,i)=>{const $=_("plus"),b=_("el-icon"),A=_("el-button"),I=_("el-col"),N=_("el-row"),z=_("CircleClose"),q=_("el-popconfirm");return d(),p("div",null,[e("div",null,[o(N,{class:"top-search-box mb-3"},{default:a(()=>[o(I,{span:14},{default:a(()=>[e("div",vt,[o(A,{onClick:i[0]||(i[0]=m=>u.value=!0),type:"primary"},{default:a(()=>[o(b,{class:"add-btn",color:"#fff"},{default:a(()=>[o($)]),_:1}),F(" \xA0"+f(x.$t("msg.table.add")),1)]),_:1}),o(A,{style:{"margin-left":"10px"},onClick:i[1]||(i[1]=m=>s.value=-1),type:s.value==-1?"primary":"",plain:""},{default:a(()=>[ht]),_:1},8,["type"]),o(A,{style:{"margin-left":"10px"},onClick:i[2]||(i[2]=m=>s.value=1),type:s.value==1?"primary":"",plain:""},{default:a(()=>[ft]),_:1},8,["type"]),o(A,{style:{"margin-left":"10px"},onClick:i[3]||(i[3]=m=>s.value=0),type:s.value==0?"primary":"",plain:""},{default:a(()=>[yt]),_:1},8,["type"])])]),_:1})]),_:1}),e("div",xt,[(d(!0),p(V,null,P(c.value,(m,k)=>(d(),p(V,{key:k},[s.value==-1||m.state==s.value?(d(),p("div",{key:0,class:J(["mx-3 h-40 w-50 shadow-md rounded-lg relative",m.state?"bg-red-400 text-white":"bg-gray-300 text-gray-600"])},[e("div",gt,[e("div",kt,"\u9910\u684C\u540D\u79F0\uFF1A"+f(m.name),1),o(q,{title:"\u662F\u5426\u5220\u9664",onConfirm:T=>v(m.id)},{reference:a(()=>[e("div",Ft,[o(b,null,{default:a(()=>[o(z)]),_:1})])]),_:2},1032,["onConfirm"])]),e("div",{class:"bg-white h-30 cursor-pointer",onClick:T=>C(k)},[e("div",At,[bt,F(" "+f(m.money),1)])],8,wt),e("div",{class:"text-right mr-1 cursor-pointer absolute right-2 bottom-1",onClick:T=>y(m)},Et,8,$t)],2)):B("",!0)],64))),128))])]),o(ct,{modelValue:n.value,"onUpdate:modelValue":i[4]||(i[4]=m=>n.value=m),erweimaData:r.value},null,8,["modelValue","erweimaData"]),o(rt,{modelValue:l.value,"onUpdate:modelValue":i[5]||(i[5]=m=>l.value=m)},null,8,["modelValue"]),o(pt,{modelValue:u.value,"onUpdate:modelValue":i[6]||(i[6]=m=>u.value=m),onSub:w},null,8,["modelValue"])])}}}),Bt={key:0},Vt={key:1,class:"text-center mt-40"},Tt=F("\u53BB\u4FEE\u6539"),Ut=E({__name:"index",setup(t){const l=h(!0);X(()=>{l.value=Q().isDesk});const n=()=>{ne.push("/sys/index")};return(u,c)=>{const r=_("el-button"),s=_("el-empty");return d(),p("div",null,[l.value?(d(),p("div",Bt,[o(Ct)])):(d(),p("div",Vt,[o(s,{description:"\u652F\u4ED8\u6A21\u5F0F\u4E3A\uFF1A\u540E\u4ED8\uFF0C\u624D\u652F\u6301\u9910\u684C\u7BA1\u7406"},{default:a(()=>[o(r,{type:"primary",onClick:n},{default:a(()=>[Tt]),_:1})]),_:1})]))])}}});export{Ut as default};
