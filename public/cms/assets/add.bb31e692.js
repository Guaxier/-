var N=(m,y,i)=>new Promise((C,f)=>{var V=d=>{try{p(i.next(d))}catch(g){f(g)}},n=d=>{try{p(i.throw(d))}catch(g){f(g)}},p=d=>d.done?C(d.value):Promise.resolve(d.value).then(V,n);p((i=i.apply(m,y)).next())});import{p as X}from"./picLib.ebfc09fb.js";import{c as ee,d as te,e as oe}from"./article.12d26598.js";import{q as le,Y as ae,r as b,A as M,Z as ue,d as ne,o as de,$ as F,C as se,c as x,a as k,b as e,w as o,f as u,g as _,h as A,L as re,F as R,v as S,x as r,i as T,E as I,a2 as ie,_ as ce}from"./index.aa0178c7.js";import{E as _e,T as me,r as fe}from"./style.333266d0.js";import"./useimg.1f5e3688.js";const pe=le();function ge(){const m=ae(),y=b("default"),i={excludeKeys:["group-indent","todo","emotion","group-video","undo","redo"]},C={placeholder:"\u8BF7\u8F93\u5165\u5185\u5BB9...",MENU_CONF:{uploadImage:{fieldName:"file",server:M.BASE_API+"addWangImg",maxFileSize:1*1024*1024,maxNumberOfFiles:5,allowedFileTypes:["image/*"],headers:{Accept:"text/x-json",Authorization:"Bearer "+pe.getToken}}}};ue(()=>{const n=m.value;n!=null&&n.destroy()});const f=n=>{m.value=n};function V(){const n=fe.getToolbar(m.value);if(n){const p=n.getConfig().toolbarKeys;console.log("tool:",p)}}return{Editor:_e,Toolbar:me,editorRef:m,mode:y,toolbarConfig:i,editorConfig:C,handleCreated:f,getToolInfo:V}}const ve={class:"page-article-add right-main"},be={class:"top-back flex mb-4"},ye=T(" \u8FD4 \u56DE"),Ce={class:"ctx_add py-2"},Ve=["src"],Fe={class:"editBox"},he=T(" \u63D0\u4EA4 "),Ee=T(" \u63D0\u4EA4\u4FEE\u6539 "),xe=ne({__name:"add",setup(m){const{Editor:y,Toolbar:i,editorRef:C,mode:f,toolbarConfig:V,editorConfig:n,handleCreated:p}=ge(),d=b(!1),g=b(),h=b([]),O=[{id:1,name:"\u72EC\u7ACB"},{id:2,name:"\u5217\u8868"}],j=b(!1);let B=0;de(()=>{F.currentRoute.value&&F.currentRoute.value.query.id&&(B=F.currentRoute.value.query.id,q(B))});const q=s=>N(this,null,function*(){const t=yield ee(s);t.date=t.date*1e3,a.data=t,v.value=!!t.jump_url,j.value=!0,h.value=[t.url]}),z=(s,t)=>{h.value=t,a.data.img_id=s[0]},K=()=>{g.value=1,d.value=!0},v=b(!1),a=se({data:{title:"",short_title:"",desc:"",content:"",img_id:0,date:new Date,source:"",category_id:1,jump_url:""}}),P=()=>{v.value?a.data.content="":a.data.jump_url="",a.data.date=Math.round(a.data.date/1e3),te(a.data).then(s=>{I.success("\u521B\u5EFA\u6210\u529F"),F.push("/other/article")})},$=()=>{let s=ie(a.data);v.value||(s.jump_url=""),s.id=B,s.date=s.date/1e3,oe(s).then(t=>{I.success("\u4FEE\u6539\u6210\u529F"),F.push("/other/article")})};return(s,t)=>{const W=u("ArrowLeft"),L=u("el-icon"),w=u("el-button"),Y=u("router-link"),U=u("el-input"),c=u("el-form-item"),D=u("el-col"),Z=u("el-checkbox"),E=u("el-row"),G=u("el-option"),H=u("el-select"),J=u("plus"),Q=u("el-form");return _(),x("div",ve,[k("div",be,[e(Y,{to:"/other/article"},{default:o(()=>[e(w,{type:"primary"},{default:o(()=>[e(L,null,{default:o(()=>[e(W)]),_:1}),ye]),_:1})]),_:1})]),k("div",Ce,[e(Q,{model:a,"label-width":"100px"},{default:o(()=>[e(E,null,{default:o(()=>[e(D,{span:14},{default:o(()=>[e(c,{label:"\u6807\u9898"},{default:o(()=>[e(U,{modelValue:a.data.title,"onUpdate:modelValue":t[0]||(t[0]=l=>a.data.title=l)},null,8,["modelValue"])]),_:1})]),_:1}),e(D,{span:2},{default:o(()=>[e(c,{label:"\u8DF3\u8F6C"},{default:o(()=>[e(Z,{modelValue:v.value,"onUpdate:modelValue":t[1]||(t[1]=l=>v.value=l)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(E,null,{default:o(()=>[v.value?(_(),A(D,{key:0,span:16},{default:o(()=>[e(c,{label:"\u8DF3\u8F6C\u5230"},{default:o(()=>[e(U,{modelValue:a.data.jump_url,"onUpdate:modelValue":t[2]||(t[2]=l=>a.data.jump_url=l),placeholder:"\u8BF7\u8F93\u5165\u7F51\u5740"},null,8,["modelValue"])]),_:1})]),_:1})):re("",!0)]),_:1}),e(c,{label:"\u6587\u7AE0\u6458\u8981"},{default:o(()=>[e(U,{modelValue:a.data.desc,"onUpdate:modelValue":t[3]||(t[3]=l=>a.data.desc=l)},null,8,["modelValue"])]),_:1}),e(E,null,{default:o(()=>[e(c,{label:"\u5206\u7C7B"},{default:o(()=>[e(H,{modelValue:a.data.category_id,"onUpdate:modelValue":t[4]||(t[4]=l=>a.data.category_id=l),placeholder:""},{default:o(()=>[(_(),x(R,null,S(O,l=>e(G,{key:l.id,label:l.name,value:l.id},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(E,null,{default:o(()=>[e(c,{label:"\u7F29\u7565\u56FE"},{default:o(()=>[k("div",{class:"select-img",onClick:K},[h.value.toString()===""?(_(),A(L,{key:0,size:30},{default:o(()=>[e(J)]),_:1})):(_(!0),x(R,{key:1},S(h.value,l=>(_(),x("img",{key:l,class:"w-full h-full",src:r(M).BASE_URL+l},null,8,Ve))),128))])]),_:1})]),_:1}),e(c,null,{default:o(()=>[k("div",Fe,[e(r(i),{class:"editTool",editor:r(C),defaultConfig:r(V),mode:r(f)},null,8,["editor","defaultConfig","mode"]),e(r(y),{class:"editCtx",style:{height:"400px"},modelValue:a.data.content,"onUpdate:modelValue":t[5]||(t[5]=l=>a.data.content=l),defaultConfig:r(n),mode:r(f),onOnCreated:r(p)},null,8,["modelValue","defaultConfig","mode","onOnCreated"])])]),_:1}),e(c,null,{default:o(()=>[j.value?(_(),A(w,{key:1,type:"primary",onClick:$},{default:o(()=>[Ee]),_:1})):(_(),A(w,{key:0,type:"primary",onClick:P},{default:o(()=>[he]),_:1}))]),_:1})]),_:1},8,["model"])]),e(X,{ref:"lib",modelValue:d.value,"onUpdate:modelValue":t[6]||(t[6]=l=>d.value=l),num:g.value,fatherFun:z},null,8,["modelValue","num"])])}}});const Te=ce(xe,[["__scopeId","data-v-d13fa0df"]]);export{Te as default};
