var Y=(V,w,k)=>new Promise((b,C)=>{var x=E=>{try{N(k.next(E))}catch(D){C(D)}},v=E=>{try{N(k.throw(E))}catch(D){C(D)}},N=E=>E.done?b(E.value):Promise.resolve(E.value).then(x,v);N((k=k.apply(V,w)).next())});import{p as ve}from"./picLib.ebfc09fb.js";import{_ as oe,o as se,r as y,G as te,f,g as p,c as g,a as _,F as L,v as S,b as l,L as G,w as o,N as ue,X as ge,t as le,i as T,p as ke,j as he,q as be,Y as ye,A as ne,Z as Ve,d as Ce,C as Ee,I as J,$ as O,a0 as Fe,h as M,x as i,Q as we,E as I,a1 as Ne}from"./index.aa0178c7.js";import{a as Ae}from"./goods.6983e12f.js";import{E as xe,T as Ue,r as Le}from"./style.333266d0.js";import"./useimg.1f5e3688.js";const Z=V=>(ke("data-v-755bebde"),V=V(),he(),V),De={id:"sku_tag"},$e={class:"form-group"},Be=Z(()=>_("div",{class:"form-h mt-2 text-gray-500 text-sm"},"\u5546\u54C1\u89C4\u683C",-1)),Ie={class:"form-title"},Se=["onClick"],Te={class:"form-list"},Re={class:"spgg_r_02_2"},Pe=["onClick"],qe=T(" \u2003 "),ze=["onClick"],Oe={class:"form-btn-group"},je=T("\u6DFB\u52A0\u89C4\u683C\u9879\u76EE"),Me={class:"form-table text-gray-500"},Ge=Z(()=>_("div",{class:"stock-title py-3"},"\u5546\u54C1\u5E93\u5B58",-1)),Ke={class:"table-sku",border:"1px solid #ccc"},Qe=Z(()=>_("th",{width:"200"},"\u4EF7\u683C",-1)),We=Z(()=>_("th",{width:"200"},"\u5E93\u5B58",-1)),Xe=["rowspan"],Ye={__name:"sku",props:{sku:{type:Array,required:!0},edit:{type:Array,required:!0}},emits:["update:sku"],setup(V,{emit:w}){const k=V;se(()=>{if(k.sku&&k.sku.tree&&k.sku.list){const e=D(k.sku);b.value=e}});const b=y([]),C=y([]),x=y(0),v=y([]),N=!1,E=1,D=e=>{let a=[];for(let[m,u]of Object.entries(e.tree)){let n=[];for(let[c,r]of Object.entries(u.v))n[c]={},n[c].cName=r.name;let h={pName:u.k,rowspan:1,spec:n};a.push(h)}return a},K=()=>{let e={pName:"",rowspan:1,spec:[{cName:""},{cName:""}]};b.value.length>=3||b.value.push(e)},$=function(e){b.value.length<2||b.value.splice(e,1)},Q=e=>{b.value[e].spec.push({cName:""})},j=(e,a)=>{b.value[e].spec.splice(a,1)},R=e=>{let a=e.length;if(a==0)return;let m=[];console.log("at:",e);for(let u=0;u<a;u++){let n={};n.pName=e[u].pName,n.spec=[],n.price={},n.stock_num={};let h=e[u].spec?e[u].spec.length:0,c=0;for(let r=0;r<h;r++){let s={},t=e[u].spec[r].cName;!t||(++c,s.cName=t,n.spec.push(s))}n.specLen=c,m.push(n)}for(let u=0,n=m.length;u<n;u++){let h=1;for(let c=u+1;c<n;c++)h*=m[c].specLen||1;m[u].rowspan=h}return m},A=e=>{let a=1,m=e.length;for(let u=0;u<m;u++)a*=e[u].specLen||1;return console.log("t:",a),a==1?e[0].spec.length:a},W=(e,a)=>{let m=[],u=[];k.edit&&k.edit.list&&(u=k.edit.list),console.log("skuList:",u);for(let n=0;n<e;n++){let h={};for(let c=0;c<a.length;c++){let r=a[c].pName,s=a[c].rowspan,t=a[c].specLen;if(!t)continue;let B=a[c].spec,U=parseInt(n/s)%t;h[r]=B[U].cName}if(h.price="",h.stock_num="",u){let c=u;c[n]&&(h.price=c[n].price,h.stock_num=c[n].stock_num)}m.push(h)}return m},X=(e,a)=>{if(e){let m=parseInt((a-1)/e.rowspan),u=e.specLen||1,n=m%u;return e.spec&&e.spec[n]&&e.spec[n].cName}};return te(b,e=>{const a=R(e);C.value=a;const m=A(a);x.value=m,v.value=W(m,a)},{deep:!0}),te(v,e=>{w("update:sku",e)},{deep:!0}),(e,a)=>{const m=f("el-input"),u=f("Close"),n=f("el-icon"),h=f("el-button"),c=f("Pic");return p(),g("div",De,[_("div",$e,[Be,(p(!0),g(L,null,S(b.value,(r,s)=>(p(),g("div",{class:"form-item",key:s},[_("div",Ie,[l(m,{class:"sku-name",modelValue:r.pName,"onUpdate:modelValue":t=>r.pName=t,placeholder:"\u89C4\u683C\u540D"},null,8,["modelValue","onUpdate:modelValue"]),s>0?(p(),g("span",{key:0,class:"delete",onClick:t=>$(s)},"\xD7",8,Se)):G("",!0)]),_("ul",Te,[(p(!0),g(L,null,S(r.spec,(t,B)=>(p(),g("li",{key:B},[_("div",Re,[l(m,{modelValue:t.cName,"onUpdate:modelValue":U=>t.cName=U},null,8,["modelValue","onUpdate:modelValue"]),B>1?(p(),g("div",{key:0,class:"in_clo",onClick:U=>j(s,B)},[l(n,{size:14},{default:o(()=>[l(u)]),_:1})],8,Pe)):G("",!0)])]))),128)),_("li",null,[qe,_("button",{class:"btn",type:"button",name:"",onClick:t=>Q(s)}," \u6DFB\u52A0 ",8,ze)])])]))),128)),_("div",Oe,[l(h,{size:"mini",disabled:b.value.length==3,type:"button",name:"",onClick:K},{default:o(()=>[je]),_:1},8,["disabled"])]),ue(_("div",Me,[Ge,_("table",Ke,[_("thead",null,[_("tr",null,[(p(!0),g(L,null,S(C.value,(r,s)=>(p(),g("th",{key:s},le(r.pName),1))),128)),Qe,We])]),_("tbody",null,[(p(!0),g(L,null,S(x.value,r=>(p(),g("tr",{key:r},[(p(!0),g(L,null,S(C.value,(s,t)=>(p(),g(L,null,[(r-1)%s.rowspan?G("",!0):(p(),g("td",{rowspan:s.rowspan,key:t},le(X(s,r)),9,Xe))],64))),256)),_("td",null,[l(m,{modelValue:v.value[r-1].price,"onUpdate:modelValue":s=>v.value[r-1].price=s,placeholder:"\u5355\u4EF7"},null,8,["modelValue","onUpdate:modelValue"])]),_("td",null,[l(m,{modelValue:v.value[r-1].stock_num,"onUpdate:modelValue":s=>v.value[r-1].stock_num=s,placeholder:"\u5E93\u5B58"},null,8,["modelValue","onUpdate:modelValue"])])]))),128))])])],512),[[ge,C.value]])]),l(c,{drawer:N,father_fun:e.get_img,length:E},null,8,["father_fun"])])}}},Ze=oe(Ye,[["__scopeId","data-v-755bebde"]]),He=be();function Je(){const V=ye(),w=y("default"),k={excludeKeys:["group-indent","todo","emotion","group-video","undo","redo"]},b={placeholder:"\u8BF7\u8F93\u5165\u5185\u5BB9...",MENU_CONF:{uploadImage:{fieldName:"file",server:ne.BASE_API+"addWangImg",maxFileSize:1*1024*1024,maxNumberOfFiles:5,allowedFileTypes:["image/*"],headers:{Accept:"text/x-json",Authorization:"Bearer "+He.getToken}}}};Ve(()=>{const v=V.value;v!=null&&v.destroy()});const C=v=>{V.value=v};function x(){const v=Le.getToolbar(V.value);if(v){const N=v.getConfig().toolbarKeys;console.log("tool:",N)}}return{Editor:xe,Toolbar:Ue,editorRef:V,mode:w,toolbarConfig:k,editorConfig:b,handleCreated:C,getToolInfo:x}}const et={class:"page-article-add right-main"},tt={class:"top-back flex mb-4"},lt=T(" \u8FD4 \u56DE"),ot={class:"ctx_add py-2"},st={class:"imgs flex"},ut=["src"],nt=T("\u65E0\u89C4\u683C"),at=T("\u6709\u89C4\u683C"),dt={class:"w-full pl-25"},it={class:"editBox"},ct=T(" \u63D0\u4EA4 "),rt=T(" \u63D0\u4EA4\u4FEE\u6539 "),pt=Ce({__name:"add",setup(V){const w=y(0),k=y(!1),{Editor:b,Toolbar:C,editorRef:x,mode:v,toolbarConfig:N,editorConfig:E,handleCreated:D}=Je();let K=0;const $=y([]),Q=y(),j=y(!1),R=y(6),A=y([]),W=y(),X=y(!1);let e=Ee({id:0,title:"",desc:"",stock:null,sale:null,content:"",sku:[],img_ids:[],price:"",before_price:"",category_id:null});function a(){let s=!0;if(e.title===""?I.info("\u5546\u54C1\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A"):e.desc===""?I.info("\u6458\u8981\u4E0D\u80FD\u4E3A\u7A7A"):e.price===""?I.info("\u552E\u4EF7\u4E0D\u80FD\u4E3A\u7A7A"):e.before_price===""?I.info("\u539F\u4EF7\u4E0D\u80FD\u4E3A\u7A7A"):e.img_ids.length<1?I.info("\u8BF7\u9009\u62E9\u56FE\u7247"):s=!1,s)throw"\u8868\u5355\u9A8C\u8BC1\u4E0D\u901A\u8FC7"}se(()=>{J().getCategray.then(s=>{W.value=s}),O.currentRoute.value&&O.currentRoute.value.query.id&&(K=O.currentRoute.value.query.id,e.id=O.currentRoute.value.query.id,m(K))});const m=s=>Y(this,null,function*(){k.value=!0;const t=yield Fe(s);t.sku&&t.sku.tree&&(w.value=1,$.value=t.sku,Q.value=t.sku),e.title=t.title,e.desc=t.desc,e.content=t.content,e.img_ids=t.img_ids,e.sale=t.sale,e.stock=t.stock,e.price=t.price,e.before_price=t.before_price,e.category_id=t.category_id,X.value=!0,A.value=t.urls,R.value=6-A.value.length,k.value=!1}),u=(s,t)=>{e.img_ids.length<1?(A.value=t,e.img_ids=s):(A.value.push(...t),e.img_ids.push(...s))},n=()=>{R.value=6-A.value.length,j.value=!0},h=s=>{e.img_ids.splice(s,1),A.value.splice(s,1)};y(!1);const c=()=>{a(),e.sku=$.value,Ae(e).then(s=>Y(this,null,function*(){yield J().setPros(),I.success("\u521B\u5EFA\u6210\u529F"),O.push("/pro/list")}))},r=()=>{a(),e.sku=$.value,Ne(e).then(s=>Y(this,null,function*(){yield J().setPros(),I.success("\u4FEE\u6539\u6210\u529F"),O.push("/pro/list")}))};return(s,t)=>{const B=f("ArrowLeft"),U=f("el-icon"),H=f("el-button"),ae=f("router-link"),P=f("el-input"),F=f("el-form-item"),q=f("el-col"),z=f("el-row"),de=f("el-option"),ie=f("el-select"),ce=f("circle-close"),re=f("plus"),ee=f("el-radio"),pe=f("el-radio-group"),_e=f("el-form"),me=we("loading");return p(),g("div",et,[_("div",tt,[l(ae,{to:"/pro/list"},{default:o(()=>[l(H,{type:"primary"},{default:o(()=>[l(U,null,{default:o(()=>[l(B)]),_:1}),lt]),_:1})]),_:1})]),_("div",ot,[ue((p(),M(_e,{model:i(e),"label-width":"100px"},{default:o(()=>[l(z,null,{default:o(()=>[l(q,{span:16},{default:o(()=>[l(F,{label:"\u5546\u54C1\u540D\u79F0"},{default:o(()=>[l(P,{modelValue:i(e).title,"onUpdate:modelValue":t[0]||(t[0]=d=>i(e).title=d)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(F,{label:"\u5546\u54C1\u6458\u8981"},{default:o(()=>[l(P,{modelValue:i(e).desc,"onUpdate:modelValue":t[1]||(t[1]=d=>i(e).desc=d),type:"text"},null,8,["modelValue"])]),_:1}),l(z,null,{default:o(()=>[l(q,{span:8},{default:o(()=>[l(F,{label:"\u5206\u7C7B"},{default:o(()=>[l(ie,{modelValue:i(e).category_id,"onUpdate:modelValue":t[2]||(t[2]=d=>i(e).category_id=d),placeholder:""},{default:o(()=>[(p(!0),g(L,null,S(W.value,d=>(p(),M(de,{key:d.id,label:d.name,value:d.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(q,{span:8},{default:o(()=>[l(F,{label:"\u552E\u4EF7"},{default:o(()=>[l(P,{modelValue:i(e).price,"onUpdate:modelValue":t[3]||(t[3]=d=>i(e).price=d),type:"text"},null,8,["modelValue"])]),_:1})]),_:1}),l(q,{span:8},{default:o(()=>[l(F,{label:"\u539F\u4EF7"},{default:o(()=>[l(P,{modelValue:i(e).before_price,"onUpdate:modelValue":t[4]||(t[4]=d=>i(e).before_price=d),type:"text"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(z,null,{default:o(()=>[l(q,{span:8},{default:o(()=>[l(F,{label:"\u9500\u91CF"},{default:o(()=>[l(P,{modelValue:i(e).sale,"onUpdate:modelValue":t[5]||(t[5]=d=>i(e).sale=d)},null,8,["modelValue"])]),_:1})]),_:1}),l(q,{span:8},{default:o(()=>[l(F,{label:"\u5E93\u5B58"},{default:o(()=>[l(P,{modelValue:i(e).stock,"onUpdate:modelValue":t[6]||(t[6]=d=>i(e).stock=d)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(z,null,{default:o(()=>[l(F,{label:"\u7F29\u7565\u56FE"},{default:o(()=>[_("div",st,[(p(!0),g(L,null,S(A.value,(d,fe)=>(p(),g("div",{class:"img mx-2",key:d},[_("img",{class:"w-full h-full",src:i(ne).BASE_URL+d},null,8,ut),l(U,{size:24,color:"#777",onClick:_t=>h(fe)},{default:o(()=>[l(ce)]),_:2},1032,["onClick"])]))),128)),R.value>0?(p(),g("div",{key:0,class:"select-img mx-2",onClick:n},[l(U,{size:30},{default:o(()=>[l(re)]),_:1})])):G("",!0)])]),_:1})]),_:1}),l(z,null,{default:o(()=>[l(F,{label:"\u89C4\u683C"},{default:o(()=>[l(pe,{modelValue:w.value,"onUpdate:modelValue":t[7]||(t[7]=d=>w.value=d)},{default:o(()=>[l(ee,{label:0,border:""},{default:o(()=>[nt]),_:1}),l(ee,{label:1,border:""},{default:o(()=>[at]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),w.value?(p(),M(z,{key:0,class:"my-3"},{default:o(()=>[_("div",dt,[l(Ze,{sku:$.value,"onUpdate:sku":t[8]||(t[8]=d=>$.value=d),edit:Q.value},null,8,["sku","edit"])])]),_:1})):G("",!0),l(F,null,{default:o(()=>[_("div",it,[l(i(C),{class:"editTool",editor:i(x),defaultConfig:i(N),mode:i(v)},null,8,["editor","defaultConfig","mode"]),l(i(b),{class:"editCtx",style:{height:"400px"},modelValue:i(e).content,"onUpdate:modelValue":t[9]||(t[9]=d=>i(e).content=d),defaultConfig:i(E),mode:i(v),onOnCreated:i(D)},null,8,["modelValue","defaultConfig","mode","onOnCreated"])])]),_:1}),l(F,null,{default:o(()=>[X.value?(p(),M(H,{key:1,type:"primary",onClick:r},{default:o(()=>[rt]),_:1})):(p(),M(H,{key:0,type:"primary",onClick:c},{default:o(()=>[ct]),_:1}))]),_:1})]),_:1},8,["model"])),[[me,k.value]])]),l(ve,{ref:"lib",modelValue:j.value,"onUpdate:modelValue":t[10]||(t[10]=d=>j.value=d),num:R.value,fatherFun:u},null,8,["modelValue","num"])])}}});const bt=oe(pt,[["__scopeId","data-v-5ced0c35"]]);export{bt as default};
