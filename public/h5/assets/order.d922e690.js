import{J as e,y as s,K as t,L as o}from"./index.325fe786.js";import{a as r,b as i}from"./order.73d436b0.js";const d=e("order",{state:()=>({desk:{id:0,name:"",state:0,order_id:0},pros:[],pro_money:0,total_money:0}),getters:{getPro(e){return e=>{if(this.pros.length<1||!this.pros[e])throw"购物车内无商品";return this.pros[e]}}},actions:{setDesk(e){this.desk={id:e.id,name:e.name,state:e.state,order_id:e.order_id?e.order_id:0}},setProsbyOnly(e){h(e.title,this.pros);const s={goods_id:e.id,goods_name:e.title,url:e.url,num:1,sku_name:"",price:e.price};this.pros.push(s),this.setProMoeny()},setNum(e,s){s>=1?this.pros[e].num=s:this.pros.splice(e,1),this.setProMoeny()},setProMoeny(){let e=0;this.pros.forEach((s=>{e+=s.num*s.price})),this.pro_money=e},setMoney(){r({pros:this.pros}).then((e=>{this.pro_money=e.total,this.total_money=e.total,s({url:"/pages/pay/placeOrder"})}))},createDeskOrder(){const e={desk_id:this.desk.id,money:this.pro_money,total_money:this.total_money,json:this.pros};i(e).then((e=>{t("订单创建成功"),this.setDefault(),this.desk.order_id=e.id,setTimeout((()=>{o({url:"/pages/my/order/detail?id="+e.id})}),1e3)}))},setDefault(){this.pros=[],this.pro_money=0,this.total_money=0}}}),a=()=>p.desk.id<0?(t("未选择餐桌"),!1):p.pros.length<1?(t("购物车无商品"),!1):void p.setMoney(),n=()=>p.desk.id<0?(t("未选择餐桌"),!1):p.pros.length<1?(t("购物车无商品"),!1):void p.createDeskOrder(),h=(e,s)=>{!s||s.length<1||s.forEach((s=>{if(s.goods_name===e)throw t("已存在"),"已存在"}))},p=d();export{p as a,n as b,a as j,d as u};
